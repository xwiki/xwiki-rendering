.#-----------------------------------------------------
.inputexpect|xwiki/2.0
.# Verify support for the figure caption syntax with nested link and list.
.#-----------------------------------------------------
[[Image **Caption**>>image:my.png||param1="value1" param2="value2"]]

[[Caption

* With
* nested
* list ~[~[and link~>~>https://xwiki.org~]~] and ~~~[~~~[fake link~]~].>>image:Space.ExistingPage@my.png]]
.#-----------------------------------------------------
.expect|event/1.0
.#-----------------------------------------------------
beginDocument
beginFigure [[class]=[image]]
onImage [Typed = [false] Type = [attach] Reference = [my.png]] [false] [Imy.png] [[param1]=[value1][param2]=[value2]]
beginFigureCaption
beginParagraph
onWord [Image]
onSpace
beginFormat [BOLD]
onWord [Caption]
endFormat [BOLD]
endParagraph
endFigureCaption
endFigure [[class]=[image]]
beginFigure [[class]=[image]]
onImage [Typed = [false] Type = [attach] Reference = [Space.ExistingPage@my.png]] [false] [ISpace.ExistingPage40my.png]
beginFigureCaption
beginParagraph
onWord [Caption]
endParagraph
beginList [BULLETED]
beginListItem
onWord [With]
endListItem
beginListItem
onWord [nested]
endListItem
beginListItem
onWord [list]
onSpace
beginLink [Typed = [false] Type = [url] Reference = [https://xwiki.org]] [false]
onWord [and]
onSpace
onWord [link]
endLink [Typed = [false] Type = [url] Reference = [https://xwiki.org]] [false]
onSpace
onWord [and]
onSpace
onSpecialSymbol [[]
onSpecialSymbol [[]
onWord [fake]
onSpace
onWord [link]
onSpecialSymbol []]
onSpecialSymbol []]
onSpecialSymbol [.]
endListItem
endList [BULLETED]
endFigureCaption
endFigure [[class]=[image]]
endDocument
.#-----------------------------------------------------
.expect|xhtml/1.0
.#-----------------------------------------------------
<img src="imageurl" param1="value1" param2="value2" id="Imy.png" class="wikigeneratedid" alt="my.png"/><div class="figcaption"><p>Image <strong>Caption</strong></p></div><img src="imageurl" id="ISpace.ExistingPage40my.png" class="wikigeneratedid" alt="Space.ExistingPage@my.png"/><div class="figcaption"><p>Caption</p><ul><li>With</li><li>nested</li><li>list <span class="wikiexternallink"><a href="https://xwiki.org">and link</a></span> and [[fake link]].</li></ul></div>
.#-----------------------------------------------------
.expect|html/5.0
.#-----------------------------------------------------
<figure class="image"><img src="imageurl" param1="value1" param2="value2" id="Imy.png" class="wikigeneratedid" alt="my.png"/><figcaption><p>Image <strong>Caption</strong></p></figcaption></figure><figure class="image"><img src="imageurl" id="ISpace.ExistingPage40my.png" class="wikigeneratedid" alt="Space.ExistingPage@my.png"/><figcaption><p>Caption</p><ul><li>With</li><li>nested</li><li>list <span class="wikiexternallink"><a href="https://xwiki.org">and link</a></span> and [[fake link]].</li></ul></figcaption></figure>